"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++){s(r[o])}return s})({1:[function(require,module,exports){"use strict";var VINT=function(){function VINT(raw,width,data){_classCallCheck(this,VINT);this.raw=raw;this.width=width;this.data=data}_createClass(VINT,null,[{key:"read",value:function read(dataview,offset){var tempOctet=dataview.getUint8(offset);var leadingZeroes=0;var zeroMask=128;do{if(tempOctet&zeroMask)break;zeroMask=zeroMask>>1;leadingZeroes++}while(leadingZeroes<8);var vint_width=leadingZeroes+1;var vint_data;var vint_raw;switch(vint_width){case 1:vint_raw=tempOctet;vint_data=tempOctet&127;break;case 2:vint_raw=dataview.getUint16(offset);vint_data=vint_raw&16383;break;case 3:vint_raw=dataview.getUint32(offset)>>8;vint_data=vint_raw&2097151;break;case 4:vint_raw=dataview.getUint32(offset);vint_data=vint_raw&268435455;break;case 5:vint_raw=dataview.getUint32(offset);var secondInt=dataview.getUint8(offset+4);vint_raw=firstInt<<8|secondInt;vint_data=vint_raw&34359738367;break;case 6:vint_raw=dataview.getUint32(offset);var secondInt=dataview.getUint16(offset+4);vint_raw=firstInt<<16|secondInt;vint_data=vint_raw&2199023255551;break;case 7:vint_raw=dataview.getUint32(offset);var secondInt=dataview.getUint32(offset+4)&16777215;vint_raw=firstInt<<24|secondInt;vint_data=vint_raw&562949953421311;break;case 8:vint_raw=dataview.getFloat64(offset);var firstInt=dataview.getUint32(offset)&1048575;var secondInt=dataview.getUint32(offset+4);vint_data=firstInt<<32|secondInt;break}return new VINT(vint_raw,vint_width,vint_data)}}]);return VINT}();module.exports=VINT},{}],2:[function(require,module,exports){"use strict";var ENUMS=require("./vp9-enums");module.exports=Object.freeze({b_width_log2_lookup:[0,0,1,1,1,2,2,2,3,3,3,4,4],b_height_log2_lookup:[0,1,0,1,2,1,2,3,2,3,4,3,4],num_4x4_blocks_wide_lookup:[1,1,2,2,2,4,4,4,8,8,8,16,16],num_4x4_blocks_high_lookup:[1,2,1,2,4,2,4,8,4,8,16,8,16],mi_width_log2_lookup:[0,0,0,0,0,1,1,1,2,2,2,3,3],num_8x8_blocks_wide_lookup:[1,1,1,1,1,2,2,2,4,4,4,8,8],num_8x8_blocks_high_lookup:[1,1,1,1,2,1,2,4,2,4,8,4,8],size_group_lookup:[0,0,0,1,1,1,2,2,2,3,3,3,3],num_pels_log2_lookup:[4,5,5,6,7,7,8,9,9,10,11,11,12],partition_lookup:[[ENUMS.PARTITION_NONE,ENUMS.PARTITION_INVALID,ENUMS.PARTITION_INVALID,ENUMS.PARTITION_INVALID,ENUMS.PARTITION_INVALID,ENUMS.PARTITION_INVALID,ENUMS.PARTITION_INVALID,ENUMS.PARTITION_INVALID,ENUMS.PARTITION_INVALID,ENUMS.PARTITION_INVALID,ENUMS.PARTITION_INVALID,ENUMS.PARTITION_INVALID,ENUMS.PARTITION_INVALID],[ENUMS.PARTITION_SPLIT,ENUMS.PARTITION_VERT,ENUMS.PARTITION_HORZ,ENUMS.PARTITION_NONE,ENUMS.PARTITION_INVALID,ENUMS.PARTITION_INVALID,ENUMS.PARTITION_INVALID,ENUMS.PARTITION_INVALID,ENUMS.PARTITION_INVALID,ENUMS.PARTITION_INVALID,ENUMS.PARTITION_INVALID,ENUMS.PARTITION_INVALID,ENUMS.PARTITION_INVALID],[ENUMS.PARTITION_SPLIT,ENUMS.PARTITION_SPLIT,ENUMS.PARTITION_SPLIT,ENUMS.PARTITION_SPLIT,ENUMS.PARTITION_VERT,ENUMS.PARTITION_HORZ,ENUMS.PARTITION_NONE,ENUMS.PARTITION_INVALID,ENUMS.PARTITION_INVALID,ENUMS.PARTITION_INVALID,ENUMS.PARTITION_INVALID,ENUMS.PARTITION_INVALID,ENUMS.PARTITION_INVALID],[ENUMS.PARTITION_SPLIT,ENUMS.PARTITION_SPLIT,ENUMS.PARTITION_SPLIT,ENUMS.PARTITION_SPLIT,ENUMS.PARTITION_SPLIT,ENUMS.PARTITION_SPLIT,ENUMS.PARTITION_SPLIT,ENUMS.PARTITION_VERT,ENUMS.PARTITION_HORZ,ENUMS.PARTITION_NONE,ENUMS.PARTITION_INVALID,ENUMS.PARTITION_INVALID,ENUMS.PARTITION_INVALID],[ENUMS.PARTITION_SPLIT,ENUMS.PARTITION_SPLIT,ENUMS.PARTITION_SPLIT,ENUMS.PARTITION_SPLIT,ENUMS.PARTITION_SPLIT,ENUMS.PARTITION_SPLIT,ENUMS.PARTITION_SPLIT,ENUMS.PARTITION_SPLIT,ENUMS.PARTITION_SPLIT,ENUMS.PARTITION_SPLIT,ENUMS.PARTITION_VERT,ENUMS.PARTITION_HORZ,ENUMS.PARTITION_NONE]],subsize_lookup:[[ENUMS.BLOCK_4X4,ENUMS.BLOCK_4X8,ENUMS.BLOCK_8X4,ENUMS.BLOCK_8X8,ENUMS.BLOCK_8X16,ENUMS.BLOCK_16X8,ENUMS.BLOCK_16X16,ENUMS.BLOCK_16X32,ENUMS.BLOCK_32X16,ENUMS.BLOCK_32X32,ENUMS.BLOCK_32X64,ENUMS.BLOCK_64X32,ENUMS.BLOCK_64X64],[ENUMS.BLOCK_INVALID,ENUMS.BLOCK_INVALID,ENUMS.BLOCK_INVALID,ENUMS.BLOCK_8X4,ENUMS.BLOCK_INVALID,ENUMS.BLOCK_INVALID,ENUMS.BLOCK_16X8,ENUMS.BLOCK_INVALID,ENUMS.BLOCK_INVALID,ENUMS.BLOCK_32X16,ENUMS.BLOCK_INVALID,ENUMS.BLOCK_INVALID,ENUMS.BLOCK_64X32],[ENUMS.BLOCK_INVALID,ENUMS.BLOCK_INVALID,ENUMS.BLOCK_INVALID,ENUMS.BLOCK_4X8,ENUMS.BLOCK_INVALID,ENUMS.BLOCK_INVALID,ENUMS.BLOCK_8X16,ENUMS.BLOCK_INVALID,ENUMS.BLOCK_INVALID,ENUMS.BLOCK_16X32,ENUMS.BLOCK_INVALID,ENUMS.BLOCK_INVALID,ENUMS.BLOCK_32X64],[ENUMS.BLOCK_INVALID,ENUMS.BLOCK_INVALID,ENUMS.BLOCK_INVALID,ENUMS.BLOCK_4X4,ENUMS.BLOCK_INVALID,ENUMS.BLOCK_INVALID,ENUMS.BLOCK_8X8,ENUMS.BLOCK_INVALID,ENUMS.BLOCK_INVALID,ENUMS.BLOCK_16X16,ENUMS.BLOCK_INVALID,ENUMS.BLOCK_INVALID,ENUMS.BLOCK_32X32]],max_txsize_lookup:[ENUMS.TX_4X4,ENUMS.TX_4X4,ENUMS.TX_4X4,ENUMS.TX_8X8,ENUMS.TX_8X8,ENUMS.TX_8X8,ENUMS.TX_16X16,ENUMS.TX_16X16,ENUMS.TX_16X16,ENUMS.TX_32X32,ENUMS.TX_32X32,ENUMS.TX_32X32,ENUMS.TX_32X32],txsize_to_bsize:[ENUMS.BLOCK_4X4,ENUMS.BLOCK_8X8,ENUMS.BLOCK_16X16,ENUMS.BLOCK_32X32],tx_mode_to_biggest_tx_size:[ENUMS.TX_4X4,ENUMS.TX_8X8,ENUMS.TX_16X16,ENUMS.TX_32X32,ENUMS.TX_32X32],ss_size_lookup:[[[ENUMS.BLOCK_4X4,ENUMS.BLOCK_INVALID],[ENUMS.BLOCK_INVALID,ENUMS.BLOCK_INVALID]],[[ENUMS.BLOCK_4X8,ENUMS.BLOCK_4X4],[ENUMS.BLOCK_INVALID,ENUMS.BLOCK_INVALID]],[[ENUMS.BLOCK_8X4,ENUMS.BLOCK_INVALID],[ENUMS.BLOCK_4X4,ENUMS.BLOCK_INVALID]],[[ENUMS.BLOCK_8X8,ENUMS.BLOCK_8X4],[ENUMS.BLOCK_4X8,ENUMS.BLOCK_4X4]],[[ENUMS.BLOCK_8X16,ENUMS.BLOCK_8X8],[ENUMS.BLOCK_INVALID,ENUMS.BLOCK_4X8]],[[ENUMS.BLOCK_16X8,ENUMS.BLOCK_INVALID],[ENUMS.BLOCK_8X8,ENUMS.BLOCK_8X4]],[[ENUMS.BLOCK_16X16,ENUMS.BLOCK_16X8],[ENUMS.BLOCK_8X16,ENUMS.BLOCK_8X8]],[[ENUMS.BLOCK_16X32,ENUMS.BLOCK_16X16],[ENUMS.BLOCK_INVALID,ENUMS.BLOCK_8X16]],[[ENUMS.BLOCK_32X16,ENUMS.BLOCK_INVALID],[ENUMS.BLOCK_16X16,ENUMS.BLOCK_16X8]],[[ENUMS.BLOCK_32X32,ENUMS.BLOCK_32X16],[ENUMS.BLOCK_16X32,ENUMS.BLOCK_16X16]],[[ENUMS.BLOCK_32X64,ENUMS.BLOCK_32X32],[ENUMS.BLOCK_INVALID,ENUMS.BLOCK_16X32]],[[ENUMS.BLOCK_64X32,ENUMS.BLOCK_INVALID],[ENUMS.BLOCK_32X32,ENUMS.BLOCK_32X16]],[[ENUMS.BLOCK_64X64,ENUMS.BLOCK_64X32],[ENUMS.BLOCK_32X64,ENUMS.BLOCK_32X32]]],partition_context_lookup:[{above:15,left:15},{above:15,left:14},{above:14,left:15},{above:14,left:14},{above:14,left:12},{above:12,left:14},{above:12,left:12},{above:12,left:8},{above:8,left:12},{above:8,left:8},{above:8,left:0},{above:0,left:8},{above:0,left:0}]})},{"./vp9-enums":3}],3:[function(require,module,exports){"use strict";module.exports=Object.freeze({MI_SIZE_LOG2:3,MI_BLOCK_SIZE_LOG2:6-this.MI_SIZE_LOG2,MI_SIZE:1<<this.MI_SIZE_LOG2,MI_BLOCK_SIZE:1<<this.MI_BLOCK_SIZE_LOG2,MI_MASK:this.MI_BLOCK_SIZE-1,PROFILE_0:0,PROFILE_1:1,PROFILE_2:2,PROFILE_3:3,MAX_PROFILES:4,BLOCK_4X4:0,BLOCK_4X8:1,BLOCK_8X4:2,BLOCK_8X8:3,BLOCK_8X16:4,BLOCK_16X8:5,BLOCK_16X16:6,BLOCK_16X32:7,BLOCK_32X16:8,BLOCK_32X32:9,BLOCK_32X64:10,BLOCK_64X32:11,BLOCK_64X64:12,BLOCK_SIZES:13,BLOCK_INVALID:this.BLOCK_SIZES,PARTITION_NONE:0,PARTITION_HORZ:1,PARTITION_VERT:2,PARTITION_SPLIT:3,PARTITION_TYPES:4,PARTITION_INVALID:this.PARTITION_TYPES,PARTITION_PLOFFSET:4,PARTITION_CONTEXTS:4*this.PARTITION_PLOFFSET,TX_4X4:0,TX_8X8:1,TX_16X16:2,TX_32X32:3,TX_SIZES:4,ONLY_4X4:0,ALLOW_8X8:1,ALLOW_16X16:2,ALLOW_32X32:3,TX_MODE_SELECT:4,TX_MODES:5,DCT_DCT:0,ADST_DCT:1,DCT_ADST:2,ADST_ADST:3,TX_TYPES:4,VP9_LAST_FLAG:1<<0,VP9_GOLD_FLAG:1<<1,VP9_ALT_FLAG:1<<2,PLANE_TYPE_Y:0,PLANE_TYPE_UV:1,PLANE_TYPES:2,DC_PRED:0,V_PRED:1,H_PRED:2,D45_PRED:3,D135_PRED:4,D117_PRED:5,D153_PRED:6,D207_PRED:7,D63_PRED:8,TM_PRED:9,NEARESTMV:10,NEARMV:11,ZEROMV:12,NEWMV:13,MB_MODE_COUNT:14,INTRA_MODES:this.TM_PRED+1,INTER_MODES:1+this.NEWMV-this.NEARESTMV,SKIP_CONTEXTS:3,INTER_MODE_CONTEXTS:7,MAX_MV_REF_CANDIDATES:2,INTRA_INTER_CONTEXTS:4,COMP_INTER_CONTEXTS:5,REF_CONTEXTS:5})},{}],4:[function(require,module,exports){"use strict";var VINT=require("./VINT.js");var VP9=require("./codecs/VP9/common/common-data.js");var FlareCodec=function(){function FlareCodec(){_classCallCheck(this,FlareCodec)}_createClass(FlareCodec,[{key:"testDecode",value:function testDecode(){var codec=VP9}}]);return FlareCodec}();var MasterSegment=function(){function MasterSegment(dataView){_classCallCheck(this,MasterSegment);this.dataView=dataView;this.offset;this.dataOffset;this.size;this.seekHead;this.info;this.tracks;this.cues;this.clusters;this.clusterCount=0;this.clusterPreloadCount=0;this.clusterSize=0}_createClass(MasterSegment,[{key:"loadCluster",value:function loadCluster(){}},{key:"doLoadCluster",value:function doLoadCluster(){}},{key:"appendCluster",value:function appendCluster(){}},{key:"preloadCluster",value:function preloadCluster(){}},{key:"parseTopLevel",value:function parseTopLevel(){var offset=this.dataOffset;var end=offset+this.size;var elementId;var elementWidth;var elementOffset;while(offset<end){elementOffset=offset;elementId=VINT.read(this.dataView,offset);offset+=elementId.width;elementWidth=VINT.read(this.dataView,offset);offset+=elementWidth.width;switch(elementId.raw){case Element.IdTable.Info:this.info=new SegmentInfo(this.dataView);this.info.offset=elementOffset;this.info.size=elementWidth.data;this.info.dataOffset=offset;this.info.parse();break;case Element.IdTable.Tracks:this.tracks=new Tracks(this.dataView);this.tracks.offset=elementOffset;this.tracks.size=elementWidth.data;this.tracks.dataOffset=offset;this.tracks.parse();break;case Element.IdTable.Cues:this.cues=new Cues(this.dataView);this.cues.offset=elementOffset;this.cues.size=elementWidth.data;this.cues.dataOffset=offset;break;case Element.IdTable.SeekHead:this.seekHead=new SeekHead(this.dataView);this.seekHead.offset=elementOffset;this.seekHead.size=elementWidth.data;this.seekHead.dataOffset=offset;this.seekHead.parse();break;case Element.IdTable.Chapters:this.chapters=new Chapters(this.dataView);this.chapters.offset=elementOffset;this.chapters.size=elementWidth.data;this.chapters.dataOffset=offset;this.chapters.parse();break;case Element.IdTable.Tags:this.tags=new Tags(this.dataView);this.tags.offset=elementOffset;this.tags.size=elementWidth.data;this.tags.dataOffset=offset;this.tags.parse();break;default:console.warn("not found id = "+elementId.raw);break}offset+=elementWidth.data}}},{key:"load",value:function load(){this.parseTopLevel()}}],[{key:"CreateInstance",value:function CreateInstance(dataView,offset){if(offset<0){console.warn("invalid position")}var elementId=VINT.read(dataView,offset);if(elementId.raw===Element.IdTable.Segment){var segment=new MasterSegment(dataView);segment.offset=offset;offset+=elementId.width;var elementSize=VINT.read(dataView,offset);segment.size=elementSize.data;segment.dataOffset=offset+elementSize.width;offset+=elementSize.data;return segment}}}]);return MasterSegment}();var SeekHead=function(){function SeekHead(dataView){_classCallCheck(this,SeekHead);this.dataView=dataView;this.offset;this.dataOffset;this.size;this.entries=[];this.entryCount=0;this.voidElements=[];this.voidElementCount=0}_createClass(SeekHead,[{key:"parse",value:function parse(){console.log("parsing seek head");this.entryCount=0;this.voidElementCount=0;var offset=this.dataOffset;var end=this.dataOffset+this.size;var elementId;var elementWidth;var elementOffset;while(offset<end){elementOffset=offset;elementId=VINT.read(this.dataView,offset);offset+=elementId.width;elementWidth=VINT.read(this.dataView,offset);offset+=elementWidth.width;if(elementId.raw===Element.IdTable.Seek){var entry=new Entry(this.dataView);entry.dataOffset=offset;entry.offset=elementOffset;entry.size=elementWidth.data;entry.parse();this.entries.push(entry)}else if(elementId.raw===Element.IdTable.Void){}offset+=elementWidth.data}this.entryCount=this.entries.length;this.voidElementCount=this.voidElements.length}}]);return SeekHead}();var Entry=function(){function Entry(dataView){_classCallCheck(this,Entry);this.dataView=dataView;this.offset;this.dataOffset;this.size;this.id}_createClass(Entry,[{key:"parse",value:function parse(){this.voidElementCount=0;var offset=this.dataOffset;var end=this.dataOffset+this.size;var elementId;var elementWidth;var elementOffset;elementOffset=offset;elementId=VINT.read(this.dataView,offset);if(elementId.raw!=Element.IdTable.SeekID){console.warn("Seek ID not found")}offset+=elementId.width;elementWidth=VINT.read(this.dataView,offset);offset+=elementWidth.width;this.id=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);offset+=elementWidth.data;elementId=VINT.read(this.dataView,offset);if(elementId.raw!=Element.IdTable.SeekPosition){console.warn("Seek Position not found")}offset+=elementId.width;elementWidth=VINT.read(this.dataView,offset);offset+=elementWidth.width;this.seekPosition=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);offset+=elementWidth.data}}]);return Entry}();var VoidElement=function VoidElement(){_classCallCheck(this,VoidElement)};var Chapters=function(){function Chapters(dataView){_classCallCheck(this,Chapters);this.dataView=dataView;this.offset;this.dataOffset;this.size}_createClass(Chapters,[{key:"parse",value:function parse(){console.log("parsing chapters")}}]);return Chapters}();var Tags=function(){function Tags(dataView){_classCallCheck(this,Tags);this.dataView=dataView;this.offset;this.dataOffset;this.size}_createClass(Tags,[{key:"parse",value:function parse(){console.log("parsing tags")}}]);return Tags}();var Cues=function Cues(dataView){_classCallCheck(this,Cues);this.dataView=dataView;this.offset;this.dataOffset;this.size};var Tracks=function(){function Tracks(dataView){_classCallCheck(this,Tracks);this.dataView=dataView;this.segment;this.offset;this.dataOffset;this.size;this.trackEntries;this.trackEntriesEnd}_createClass(Tracks,[{key:"parse",value:function parse(){console.log("parsing tracks");this.trackEntries=null;this.trackEntriesEnd=null;var end=this.dataOffset+this.size;var offset=this.dataOffset;var count=0;var elementId;var elementWidth;var elementOffset;while(offset<end){elementId=VINT.read(this.dataView,offset);offset+=elementId.width;elementWidth=VINT.read(this.dataView,offset);offset+=elementWidth.width;if(elementId.raw===Element.IdTable.TrackEntry){count++}offset+=elementWidth.data;if(offset>end)console.warn("invalid track format")}if(count<0){return}this.trackEntries=[];offset=this.dataOffset;var payloadEnd;var elementTotalSize;while(offset<end){elementOffset=offset;elementId=VINT.read(this.dataView,offset);offset+=elementId.width;elementWidth=VINT.read(this.dataView,offset);offset+=elementWidth.width;payloadEnd=offset+elementWidth.data;elementTotalSize=payloadEnd-elementOffset;if(elementId.raw===Element.IdTable.TrackEntry){this.trackEntries.push(this.ParseTrackEntry(offset,elementWidth.data))}offset+=elementWidth.data}}},{key:"ParseTrackEntry",value:function ParseTrackEntry(dataOffset,size){var trackEntry;var trackInfo=new TrackInfo;var videoSettings=new TrackSettings;var audioSettings=new TrackSettings;var encodingSettings=new TrackSettings;var lacing=1;var end=dataOffset+size;var offset=dataOffset;var elementId;var elementWidth;var elementOffset;var lacing;while(offset<end){elementOffset=offset;elementId=VINT.read(this.dataView,offset);offset+=elementId.width;elementWidth=VINT.read(this.dataView,offset);offset+=elementWidth.width;switch(elementId.raw){case Element.IdTable.Video:videoSettings.offset=elementOffset;videoSettings.dataOffset=offset;videoSettings.size=elementWidth.data;break;case Element.IdTable.Audio:audioSettings.offset=elementOffset;audioSettings.dataOffset=offset;audioSettings.size=elementWidth.data;break;case Element.IdTable.ContentEncodings:encodingSettings.offset=elementOffset;encodingSettings.dataOffset=offset;encodingSettings.size=elementWidth.data;break;case Element.IdTable.TrackUID:break;case Element.IdTable.TrackNumber:trackInfo.number=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);break;case Element.IdTable.TrackType:trackInfo.type=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);break;case Element.IdTable.Name:trackInfo.name=Element.readString(this.dataView,offset,elementWidth.data);break;case Element.IdTable.Language:trackInfo.language=Element.readString(this.dataView,offset,elementWidth.data);break;case Element.IdTable.DefaultDuration:trackInfo.defaultDuration=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);break;case Element.IdTable.CodecID:trackInfo.codecID=Element.readString(this.dataView,offset,elementWidth.data);break;case Element.IdTable.FlagLacing:lacing=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);if(lacing<0||lacing>1)console.warn("invalid lacing");break;case Element.IdTable.CodecPrivate:break;case Element.IdTable.CodecName:trackInfo.codecName=Element.readString(this.dataView,offset,elementWidth.data);break;case Element.IdTable.CodecDelay:trackInfo.codecDelay=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);break;case Element.IdTable.SeekPreRoll:trackInfo.seekPreRoll=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);break;default:console.warn("track type not found");break}offset+=elementWidth.data}if(offset!=end)console.warn("invalid track");if(trackInfo.number<=0)console.warn("invalid track number");if(trackInfo.type<=0)console.warn("invalid track type");trackInfo.lacing=lacing>0?true:false;if(trackInfo.type===Track.Video){if(videoSettings.offset<0||audioSettings.offset>=0)console.warn("invalid video settings");trackInfo.settings=videoSettings;trackEntry=new VideoTrack(this.dataView,trackInfo);trackEntry.parse()}return trackEntry}}]);return Tracks}();var Track=function Track(dataView){_classCallCheck(this,Track);this.dataView=dataView;this.offset;this.dataOffset;this.size};Track.Video=1;Track.Audio=2;var VideoTrack=function(_Track){_inherits(VideoTrack,_Track);function VideoTrack(dataView,info){_classCallCheck(this,VideoTrack);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(VideoTrack).call(this,dataView));_this.width=0;_this.height=0;_this.displayWidth=0;_this.displayHeight=0;_this.displayUnit=0;_this.stereoMode=0;_this.rate=0;_this.info=info;_this.settings=info.settings;_this.dataOffset=_this.settings.dataOffset;_this.offset=_this.settings.offset;_this.size=_this.settings.size;_this.color;return _this}_createClass(VideoTrack,[{key:"parse",value:function parse(){var end=this.dataOffset+this.size;var offset=this.dataOffset;var elementId;var elementWidth;var elementOffset;while(offset<end){elementOffset=offset;elementId=VINT.read(this.dataView,offset);offset+=elementId.width;elementWidth=VINT.read(this.dataView,offset);offset+=elementWidth.width;switch(elementId.raw){case Element.IdTable.PixelWidth:this.width=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);break;case Element.IdTable.PixelHeight:this.height=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);break;case Element.IdTable.DisplayWidth:this.displayWidth=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);break;case Element.IdTable.DisplayHeight:this.displayHeight=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);break;case Element.IdTable.DisplayUnit:this.displayUnit=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);break;case Element.IdTable.StereoMode:this.stereoMode=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);break;case Element.IdTable.FrameRate:this.frameRate=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);break;case Element.IdTable.Colour:console.log("color");break;default:break}offset+=elementWidth.data}}}]);return VideoTrack}(Track);var TrackInfo=function TrackInfo(){_classCallCheck(this,TrackInfo);this.type=0;this.number=0;this.uid=0;this.defaultDuration=0;this.language;this.codecID;this.codecName};var TrackSettings=function TrackSettings(){_classCallCheck(this,TrackSettings);this.offset=-1;this.size=-1};var SegmentInfo=function(){function SegmentInfo(dataView){_classCallCheck(this,SegmentInfo);this.dataView=dataView;this.offset;this.size;this.dataOffset;this.muxingApp;this.writingApp;this.title;this.dataOffset;this.timecodeScale;this.duration}_createClass(SegmentInfo,[{key:"parse",value:function parse(){console.log("parsing segment info");var end=this.dataOffset+this.size;var offset=this.dataOffset;var elementId;var elementWidth;var elementOffset;this.timecodeScale=1e6;this.duration=-1;while(offset<end){elementOffset=offset;elementId=VINT.read(this.dataView,offset);offset+=elementId.width;elementWidth=VINT.read(this.dataView,offset);offset+=elementWidth.width;switch(elementId.raw){case Element.IdTable.TimecodeScale:this.timecodeScale=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);if(this.timecodeScale<=0)console.warn("Invalid timecode scale");break;case Element.IdTable.Duration:this.duration=Element.readFloat(this.dataView,offset,elementWidth.data);if(this.duration<=0)console.warn("Invalid duration");break;case Element.IdTable.MuxingApp:this.muxingApp=Element.readString(this.dataView,offset,elementWidth.data);break;case Element.IdTable.WritingApp:this.writingApp=Element.readString(this.dataView,offset,elementWidth.data);break;case Element.IdTable.Title:this.title=Element.readString(this.dataView,offset,elementWidth.data);break;default:console.warn("segment info element not found");break}offset+=elementWidth.data}}}]);return SegmentInfo}();var EBMLHeader=function(){function EBMLHeader(dataView){_classCallCheck(this,EBMLHeader);this._dataView=dataView;this._totalSize=0;this.version;this.readVersion;this.maxIdLength;this.maxSizeLength;this.docTypeVersion;this.docTypeReadVersion}_createClass(EBMLHeader,[{key:"getTotalSize",value:function getTotalSize(){return this._totalSize}},{key:"parse",value:function parse(){var offset=0;var headerOffset=offset;var elementId=VINT.read(this._dataView,offset);if(elementId.raw!=Element.IdTable.EBML){console.warn("INVALID HEADER")}offset+=elementId.width;var elementSize=VINT.read(this._dataView,offset);this._totalSize=elementId.width+elementSize.width+elementSize.data;offset+=elementSize.width;var element;var end=headerOffset+elementId.width+elementSize.width+elementSize.data;while(offset<end){element=Element.getElement(this._dataView,offset,end);if(element){offset+=element.headerSize;switch(element.id){case Element.IdTable.EBMLVersion:this.version=Element.readUnsignedInt(this._dataView,offset,element.size);break;case Element.IdTable.EBMLReadVersion:this.readVersion=Element.readUnsignedInt(this._dataView,offset,element.size);break;case Element.IdTable.EBMLMaxIDLength:this.maxIdLength=Element.readUnsignedInt(this._dataView,offset,element.size);break;case Element.IdTable.EBMLMaxSizeLength:this.maxSizeLength=Element.readUnsignedInt(this._dataView,offset,element.size);break;case Element.IdTable.DocType:this.docType=Element.readString(this._dataView,offset,element.size);break;case Element.IdTable.DocTypeVersion:this.docTypeVersion=Element.readUnsignedInt(this._dataView,offset,element.size);break;case Element.IdTable.DocTypeReadVersion:this.docTypeReadVersion=Element.readUnsignedInt(this._dataView,offset,element.size);break;default:console.log("not found");break}}else{console.warn("File Reading error in header")}offset+=element.size}if(offset!=end){console.warn("invalid file format")}if(this.docType===null||this.docTypeReadVersion<=0||this.docTypeVersion<=0){console.warn("invalid file format")}if(this.maxIdLength<=0||this.maxIdLength>4||this.maxSizeLength<=0||this.maxSizeLength>8){console.warn("invalid file format")}}}]);return EBMLHeader}();var Webm=function(){function Webm(arrayBuffer){_classCallCheck(this,Webm);this.dataview=new DataView(arrayBuffer);this.header=new EBMLHeader(this.dataview);this.body=null}_createClass(Webm,[{key:"parse",value:function parse(){this.header.parse();var bodyOffset=this.header.getTotalSize();var offset=bodyOffset;this.body=MasterSegment.CreateInstance(this.dataview,offset);this.body.load();console.log(this)}},{key:"toJson",value:function toJson(){var webm={header:this.header,body:this.body};return JSON.stringify(webm,null,2)}}],[{key:"load",value:function load(arrayBuffer){var webm=new Webm(arrayBuffer);webm.parse();return webm}},{key:"getVersion",value:function getVersion(){return{major:1,minor:0,build:0,revision:30}}}]);return Webm}();var Element=function(){_createClass(Element,null,[{key:"readUnsignedInt",value:function readUnsignedInt(dataView,offset,size){if(offset<0||size<=0||size>8){console.warn("invalid file size")}var result=0;var b;for(var i=0;i<size;i++){b=dataView.getUint8(offset);if(i===0&&b<0){console.warn("invalid integer value")}result<<=8;result|=b;offset++}return result}},{key:"readFloat",value:function readFloat(dataView,offset,size){if(offset<0&&(size===4||size===8)){console.warn("invalid float size")}if(size===4){return dataView.getFloat32(offset)}else{return dataView.getFloat64(offset)}}},{key:"readUT8F",value:function readUT8F(dataView,offset,size){var tempString="";for(var i=0;i<size;i++){tempString+=String.fromCharCode(dataView.getUint8(offset+i))}return btoa(tempString)}},{key:"readString",value:function readString(dataView,offset,size){var tempString="";for(var i=0;i<size;i++){tempString+=String.fromCharCode(dataView.getUint8(offset+i))}return tempString}},{key:"getElement",value:function getElement(dataView,offset,end){var elementOffset=offset;if(offset>=end){console.warn("read error");return false}var elementIdVint=VINT.read(dataView,offset);var elementId=elementIdVint.raw;if(elementId<0){console.warn("id read error");return false}else if(elementId===0){console.warn("invalid file format");return false}offset+=elementIdVint.width;if(offset>=end){console.warn("read error");return false}var elementSize=VINT.read(dataView,offset);if(elementSize.data<0||elementSize.width<1||elementSize.width>8){console.warn("Invalid File Format");return false}offset+=elementSize.width;if(offset>=end){console.warn("read error");return false}var element=new Element(elementIdVint.raw,dataView);element.size=elementSize.data;element.dataOffset=offset;element.headerSize=elementSize.width+elementIdVint.width;return element}}]);function Element(id,dataView){_classCallCheck(this,Element);this._dataView=dataView;this._id=id;this.id=id;this._offset;this._size;this._totalSize;this.dataOffset;this.status;this.headerSize;this.size}_createClass(Element,[{key:"setSize",value:function setSize(size){this._size=size}},{key:"getTotalSize",value:function getTotalSize(){return this._size.data+this.getIdLength()+this._size.width}},{key:"setOffset",value:function setOffset(offset){this._offset=offset}},{key:"parse",value:function parse(){console.log("Needs to be implemented")}},{key:"getIdLength",value:function getIdLength(){var length;switch(this.EBMLClass){case"A":length=1;break;case"B":length=2;break;case"C":length=3;break;case"D":length=4;break}return length}}]);return Element}();var EBMLSignedInteger=function(_Element){_inherits(EBMLSignedInteger,_Element);function EBMLSignedInteger(id,dataView){_classCallCheck(this,EBMLSignedInteger);var _this2=_possibleConstructorReturn(this,Object.getPrototypeOf(EBMLSignedInteger).call(this,id,dataView));_this2.length;_this2.value;return _this2}_createClass(EBMLSignedInteger,[{key:"parse",value:function parse(){if(this._size.data===0){this.value=0}else{var tempOffset=this._offset+this.getIdLength()+this._size.width;this.value=VINT.read(this._dataView,tempOffset).data}}}]);return EBMLSignedInteger}(Element);var EBMLUnsignedInteger=function(_Element2){_inherits(EBMLUnsignedInteger,_Element2);function EBMLUnsignedInteger(id,dataView){_classCallCheck(this,EBMLUnsignedInteger);var _this3=_possibleConstructorReturn(this,Object.getPrototypeOf(EBMLUnsignedInteger).call(this,id,dataView));_this3.value;return _this3}_createClass(EBMLUnsignedInteger,[{key:"parse",value:function parse(){var tempOctet=0;var readOctet;var tempOffset=this._offset+this.getIdLength()+this._size.width;for(var i=0;i<this._size.data;i++){readOctet=this._dataView.getUint8(tempOffset+i);tempOctet=tempOctet<<8*i|readOctet}this.value=tempOctet}}]);return EBMLUnsignedInteger}(Element);var EBMLString=function(_Element3){_inherits(EBMLString,_Element3);function EBMLString(id,dataView){_classCallCheck(this,EBMLString);var _this4=_possibleConstructorReturn(this,Object.getPrototypeOf(EBMLString).call(this,id,dataView));_this4.length;_this4.value;return _this4}_createClass(EBMLString,[{key:"parse",value:function parse(){var tempOffset=this._offset+this.getIdLength()+this._size.width;var charCount=this._size.data;var tempString="";for(var i=0;i<charCount;i++){tempString+=String.fromCharCode(this._dataView.getUint8(tempOffset+i))}this.value=tempString}}]);return EBMLString}(Element);var EBMLUTF8=function(_Element4){_inherits(EBMLUTF8,_Element4);function EBMLUTF8(id,dataView){_classCallCheck(this,EBMLUTF8);var _this5=_possibleConstructorReturn(this,Object.getPrototypeOf(EBMLUTF8).call(this,id,dataView));_this5.length;_this5.value;return _this5}_createClass(EBMLUTF8,[{key:"parse",value:function parse(){var tempOffset=this._offset+this.getIdLength()+this._size.width;var charCount=this._size.data;var tempString="";for(var i=0;i<charCount;i++){tempString+=String.fromCharCode(this._dataView.getUint8(tempOffset+i))}this.value=btoa(tempString)}}]);return EBMLUTF8}(Element);var EBMLDate=function(_Element5){_inherits(EBMLDate,_Element5);function EBMLDate(id,dataView){_classCallCheck(this,EBMLDate);var _this6=_possibleConstructorReturn(this,Object.getPrototypeOf(EBMLDate).call(this,id,dataView));_this6.length;_this6.value;return _this6}return EBMLDate}(Element);var EBMLFloat=function(_Element6){_inherits(EBMLFloat,_Element6);function EBMLFloat(id,dataView){_classCallCheck(this,EBMLFloat);var _this7=_possibleConstructorReturn(this,Object.getPrototypeOf(EBMLFloat).call(this,id,dataView));_this7.length;_this7.value;return _this7}return EBMLFloat}(Element);var EBMLMasterElement=function(_Element7){_inherits(EBMLMasterElement,_Element7);function EBMLMasterElement(id,dataView){_classCallCheck(this,EBMLMasterElement);var _this8=_possibleConstructorReturn(this,Object.getPrototypeOf(EBMLMasterElement).call(this,id,dataView));_this8.length;_this8.elements=[];return _this8}_createClass(EBMLMasterElement,[{key:"getNextElement",value:function getNextElement(internalOffset){var tempOffset=internalOffset;var elementOffset=internalOffset;var elementId=VINT.read(this._dataView,internalOffset);tempOffset+=elementId.width;var elementSize=VINT.read(this._dataView,tempOffset);
var elementClass=Element.ClassTable[elementId.raw];var element;if(elementClass){element=new elementClass(this._dataView);element.setOffset(elementOffset);element.setSize(elementSize)}else{console.log("Element Not Found"+elementId.raw);return false}return element}},{key:"parse",value:function parse(){var tempOffset=this._offset+this.getIdLength()+this._size.width;var nextElement;if(this._id===Element.IdTable.Info){}while(tempOffset<this._offset+this.getTotalSize()){nextElement=this.getNextElement(tempOffset);if(nextElement){this.elements.push(nextElement);nextElement.parse();tempOffset+=nextElement.getTotalSize()}else{console.log("Element Not Found"+this);break}}}}]);return EBMLMasterElement}(Element);var EBMLBinary=function(_Element8){_inherits(EBMLBinary,_Element8);function EBMLBinary(id,dataView){_classCallCheck(this,EBMLBinary);var _this9=_possibleConstructorReturn(this,Object.getPrototypeOf(EBMLBinary).call(this,id,dataView));_this9.data;_this9._dataOffset;return _this9}_createClass(EBMLBinary,[{key:"parse",value:function parse(){this._dataOffset=this._offset+this.getIdLength()+this._size.width}}]);return EBMLBinary}(Element);var Frame=function(){function Frame(){_classCallCheck(this,Frame);this.offset;this.size}_createClass(Frame,[{key:"read",value:function read(){}}]);return Frame}();var Block=function(_EBMLBinary){_inherits(Block,_EBMLBinary);function Block(dataView){_classCallCheck(this,Block);var _this10=_possibleConstructorReturn(this,Object.getPrototypeOf(Block).call(this,Element.IdTable.Block,dataView));_this10.EBMLClass="A";_this10._m_track;_this10._m_timecode;_this10._m_flags;_this10._m_frames=[];_this10._m_frame_count=0;return _this10}_createClass(Block,[{key:"getTrackNumber",value:function getTrackNumber(){}},{key:"GetTimeCode",value:function GetTimeCode(cluster){}},{key:"GetTime",value:function GetTime(cluster){}},{key:"IsKey",value:function IsKey(){}},{key:"SetKey",value:function SetKey(){}},{key:"IsInvisible",value:function IsInvisible(){}},{key:"GetFrameCount",value:function GetFrameCount(){}},{key:"GetFrame",value:function GetFrame(frameIndex){}},{key:"GetDiscardPadding",value:function GetDiscardPadding(){}}]);return Block}(EBMLBinary);Element.IdTable={EBML:440786851,EBMLVersion:17030,EBMLReadVersion:17143,EBMLMaxIDLength:17138,EBMLMaxSizeLength:17139,DocType:17026,DocTypeVersion:17031,DocTypeReadVersion:17029,Void:236,Segment:408125543,SeekHead:290298740,Seek:19899,SeekID:21419,SeekPosition:21420,Info:357149030,TimecodeScale:2807729,Duration:17545,DateUTC:4461,Title:31657,MuxingApp:19840,WritingApp:22337,Cluster:524531317,Timecode:231,PrevSize:171,SimpleBlock:163,BlockGroup:160,Block:161,BlockAdditions:30113,BlockMore:166,BlockAddID:238,BlockAdditional:165,BlockDuration:155,ReferenceBlock:251,DiscardPadding:30114,Tracks:374648427,TrackEntry:174,TrackNumber:215,TrackUID:29637,TrackType:131,FlagEnabled:185,FlagDefault:136,FlagForced:21930,FlagLacing:156,DefaultDuration:2352003,Name:21358,Language:2274716,CodecID:134,CodecPrivate:25506,CodecName:2459272,CodecDelay:22186,SeekPreRoll:22203,Video:224,FlagInterlaced:154,StereoMode:21432,AlphaMode:21440,PixelWidth:176,PixelHeight:186,PixelCropBottom:21674,PixelCropTop:21691,PixelCropLeft:21708,PixelCropRight:21725,DisplayWidth:21680,DisplayHeight:21690,DisplayUnit:21682,AspectRatioType:21683,Audio:225,SamplingFrequency:181,OutputSamplingFrequency:30901,Channels:159,BitDepth:25188,ContentEncodings:28032,ContentEncoding:25152,ContentEncodingOrder:20529,ContentEncodingScope:20530,ContentEncodingType:20531,ContentEncryption:20533,ContentEncAlgo:18401,ContentEncKeyID:18402,FrameRate:2327523,Colour:21936,MatrixCoefficients:21937,BitsPerChannel:21938,ChromaSubsamplingHorz:21939,ChromaSubsamplingVert:21940,CbSubsamplingHorz:21941,CbSubsamplingVert:21942,ChromaSitingHorz:21943,ChromaSitingVert:21944,Range:21945,TransferCharacteristics:21946,Primaries:21947,MaxCLL:21948,MaxFALL:21949,MasteringMetadata:21968,PrimaryRChromaticityX:21969,PrimaryRChromaticityY:21970,PrimaryGChromaticityX:21971,PrimaryGChromaticityY:21972,PrimaryBChromaticityX:21973,PrimaryBChromaticityY:21974,WhitePointChromaticityX:21975,WhitePointChromaticityY:21976,LuminanceMax:21977,LuminanceMin:21978,Cues:475249515,CuePoint:187,CueTime:179,CueTrackPositions:183,CueTrack:247,CueClusterPosition:241,CueRelativePosition:240,CueDuration:178,CueBlockNumber:21368,Chapters:272869232,EditionEntry:17849,ChapterAtom:182,ChapterUID:29636,ChapterStringUID:22100,ChapterTimeStart:145,ChapterTimeEnd:146,ChapterDisplay:128,ChapString:133,ChapLanguage:17278,ChapCountry:17278,Tags:307544935,Tag:29555,Targets:25536,TargetTypeValue:26826,TargetType:25546,TagTrackUID:25541,SimpleTag:26568,TagName:17827,TagLanguage:17530,TagDefault:17543,TagString:17543,TagBinary:17541};console.log(Element.IdTable);if("global"==="global"){window.Flare=window.Flare||{};Flare.Codec=Flare.Codec||{};window.Flare.Codec.Webm=Webm}else{module.exports.Webm=Webm}},{"./VINT.js":1,"./codecs/VP9/common/common-data.js":2}]},{},[4]);