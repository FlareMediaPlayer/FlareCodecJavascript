"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++){s(r[o])}return s})({1:[function(require,module,exports){"use strict";var VINT=function(){function VINT(raw,width,data){_classCallCheck(this,VINT);this.raw=raw;this.width=width;this.data=data}_createClass(VINT,null,[{key:"read",value:function read(dataview,offset){var tempOctet=dataview.getUint8(offset);var leadingZeroes=0;var zeroMask=128;do{if(tempOctet&zeroMask)break;zeroMask=zeroMask>>1;leadingZeroes++}while(leadingZeroes<8);var vint_width=leadingZeroes+1;var vint_data;var vint_raw;switch(vint_width){case 1:vint_raw=tempOctet;vint_data=tempOctet&127;break;case 2:vint_raw=dataview.getUint16(offset);vint_data=vint_raw&16383;break;case 3:vint_raw=dataview.getUint32(offset)>>8;vint_data=vint_raw&2097151;break;case 4:vint_raw=dataview.getUint32(offset);vint_data=vint_raw&268435455;break;case 5:vint_raw=dataview.getUint32(offset);var secondInt=dataview.getUint8(offset+4);vint_raw=firstInt<<8|secondInt;vint_data=vint_raw&34359738367;break;case 6:vint_raw=dataview.getUint32(offset);var secondInt=dataview.getUint16(offset+4);vint_raw=firstInt<<16|secondInt;vint_data=vint_raw&2199023255551;break;case 7:vint_raw=dataview.getUint32(offset);var secondInt=dataview.getUint32(offset+4)&16777215;vint_raw=firstInt<<24|secondInt;vint_data=vint_raw&562949953421311;break;case 8:vint_raw=dataview.getFloat64(offset);var firstInt=dataview.getUint32(offset)&1048575;var secondInt=dataview.getUint32(offset+4);vint_data=firstInt<<32|secondInt;break}return new VINT(vint_raw,vint_width,vint_data)}}]);return VINT}();module.exports=VINT},{}],2:[function(require,module,exports){"use strict";var CONSTANTS=require("./constants.js");var VP9=function(){function VP9(){_classCallCheck(this,VP9)}_createClass(VP9,[{key:"decode",value:function decode(dataView){var frame=new Frame(dataView);frame.decode()}}]);return VP9}();var Frame=function(){function Frame(dataView){_classCallCheck(this,Frame);this.dataView=dataView;this.frameHeader}_createClass(Frame,[{key:"decode",value:function decode(){var offset=0;this.frameHeader=new FrameHeader(this.dataView);this.frameHeader.offset=0;this.frameHeader.parse()}},{key:"parseHeader",value:function parseHeader(){}}]);return Frame}();var FrameHeader=function(){function FrameHeader(dataView){_classCallCheck(this,FrameHeader);this.dataView=dataView;this.offset;this.frameMarker;this.profileLowBit;this.profileHighBit;this.profile}_createClass(FrameHeader,[{key:"parse",value:function parse(){var offset=this.offset;var tempByte=this.dataView.getUint8(offset);offset++;this.frameMarker=tempByte>>6;this.profileLowBit=(tempByte&32)>>5;this.profileHighBit=(tempByte&16)>>4;this.profile=(this.profileHighBit<<1)+this.profileLowBit;if(this.profile===3){}this.showExistingFrame=tempByte>>3&1;this.frameType=tempByte>>2&1;this.showFrame=tempByte>>1&1;this.errorResilientMode=tempByte&1;if(this.frameType===CONSTANTS.KEY_FRAME){this.frameSyncCode(offset);offset+=3;this.colorConfig(offset);offset++;this.frameSize(offset);this.renderSize(offset);this.refresh_frame_flags=255;this.frameIsIntra=1}console.log(this)}},{key:"frameSyncCode",value:function frameSyncCode(offset){this.frameSyncCode1=this.dataView.getUint8(offset);console.log(offset);offset++;this.frameSyncCode2=this.dataView.getUint8(offset);offset++;console.log(offset);this.frameSyncCode3=this.dataView.getUint8(offset)}},{key:"frameSize",value:function frameSize(offset){this.frameWidth=this.dataView.getUint16(offset)+1;offset+=2;this.frameHeight=this.dataView.getUint16(offset)+1;this.computeImageSize()}},{key:"computeImageSize",value:function computeImageSize(){this.miCols=this.frameWidth+7>>3;this.miRows=this.frameHeight+7>>3;this.sb64Cols=this.miCols+7>>3;this.sb64Rows=this.miRows+7>>3}},{key:"renderSize",value:function renderSize(offset){}},{key:"colorConfig",value:function colorConfig(offset){var tempByte=this.dataView.getUint8(offset);if(this.profile>=2){this.tenOrTwelveBit=tempByte>>7&1;this.bitDepth=this.tenOrTwelveBit?12:10}else{this.bitDepth=8}this.colorSpace=tempByte>>4&7;if(this.colorSpace!=CONSTANTS.CS_RGB){this.colorRange=tempByte>>3&1;if(this.profile==1||this.profile==3){this.subsamplingX=tempByte>>2&1;this.subsamplingY=tempByte>>1&1}else{this.subsamplingX=1;this.subsamplingY=1}}else{this.colorRange=1;if(this.profile==1||this.profile==3){this.subsamplingX=0;this.subsamplingY=0}}}}]);return FrameHeader}();module.exports=VP9},{"./constants.js":3}],3:[function(require,module,exports){module.exports=Object.freeze({KEY_FRAME:0,CS_RGB:7})},{}],4:[function(require,module,exports){"use strict";var VINT=require("./VINT.js");var VP9=require("./codecs/VP9/VP9.js");var FlareCodec=function(){function FlareCodec(){_classCallCheck(this,FlareCodec)}_createClass(FlareCodec,[{key:"testDecode",value:function testDecode(){var codec=VP9}}]);return FlareCodec}();var MasterSegment=function(){function MasterSegment(dataView){_classCallCheck(this,MasterSegment);this.dataView=dataView;this.offset;this.dataOffset;this.size;this.seekHead;this.info;this.tracks;this.cues;this.clusters=[];this.clusterCount=0;this.clusterPreloadCount=0;this.clusterSize=0}_createClass(MasterSegment,[{key:"loadCluster",value:function loadCluster(){this.doLoadCluster()}},{key:"doLoadCluster",value:function doLoadCluster(){}},{key:"appendCluster",value:function appendCluster(){}},{key:"preloadCluster",value:function preloadCluster(){}},{key:"parseTopLevel",value:function parseTopLevel(){var offset=this.dataOffset;var end=offset+this.size;var elementId;var elementWidth;var elementOffset;while(offset<end){elementOffset=offset;elementId=VINT.read(this.dataView,offset);offset+=elementId.width;elementWidth=VINT.read(this.dataView,offset);offset+=elementWidth.width;switch(elementId.raw){case Element.IdTable.Info:this.info=new SegmentInfo(this.dataView);this.info.offset=elementOffset;this.info.size=elementWidth.data;this.info.dataOffset=offset;this.info.parse();break;case Element.IdTable.Tracks:this.tracks=new Tracks(this.dataView);this.tracks.offset=elementOffset;this.tracks.size=elementWidth.data;this.tracks.dataOffset=offset;this.tracks.parse();break;case Element.IdTable.Cues:this.cues=new Cues(this.dataView);this.cues.offset=elementOffset;this.cues.size=elementWidth.data;this.cues.dataOffset=offset;break;case Element.IdTable.SeekHead:this.seekHead=new SeekHead(this.dataView);this.seekHead.offset=elementOffset;this.seekHead.size=elementWidth.data;this.seekHead.dataOffset=offset;this.seekHead.parse();break;case Element.IdTable.Chapters:this.chapters=new Chapters(this.dataView);this.chapters.offset=elementOffset;this.chapters.size=elementWidth.data;this.chapters.dataOffset=offset;this.chapters.parse();break;case Element.IdTable.Tags:this.tags=new Tags(this.dataView);this.tags.offset=elementOffset;this.tags.size=elementWidth.data;this.tags.dataOffset=offset;this.tags.parse();break;case Element.IdTable.Cluster:var cluster;cluster=new Cluster(this.dataView);cluster.offset=elementOffset;cluster.size=elementWidth.data;cluster.dataOffset=offset;cluster.parse();this.cluster=cluster;break;default:console.warn("not found id = "+elementId.raw);break}offset+=elementWidth.data}}},{key:"load",value:function load(){this.parseTopLevel()}}],[{key:"CreateInstance",value:function CreateInstance(dataView,offset){if(offset<0){console.warn("invalid position")}var elementId=VINT.read(dataView,offset);if(elementId.raw===Element.IdTable.Segment){var segment=new MasterSegment(dataView);segment.offset=offset;offset+=elementId.width;var elementSize=VINT.read(dataView,offset);segment.size=elementSize.data;segment.dataOffset=offset+elementSize.width;offset+=elementSize.data;return segment}}}]);return MasterSegment}();var Cluster=function(){function Cluster(dataView){_classCallCheck(this,Cluster);this.dataView=dataView;this.offset;this.dataOffset;this.size;this.timeCode;this.entries=[];this.entriesSize;this.entriesCount;this.segment}_createClass(Cluster,[{key:"parse",value:function parse(){var offset=this.dataOffset;var end=offset+this.size;var elementId;var elementWidth;var elementOffset;while(offset<end){elementOffset=offset;elementId=VINT.read(this.dataView,offset);offset+=elementId.width;elementWidth=VINT.read(this.dataView,offset);offset+=elementWidth.width;switch(elementId.raw){case Element.IdTable.Timecode:this.timeCode=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);break;case Element.IdTable.SimpleBlock:var entry=new SimpleBlock(this.dataView);entry.offset=elementOffset;entry.size=elementWidth.data;entry.dataOffset=offset;entry.parse();this.entries.push(entry);break;case Element.IdTable.BlockGroup:console.warn("Need to implement block group");break;default:console.warn("not found id = "+elementId.raw);break}offset+=elementWidth.data}}},{key:"getTime",value:function getTime(){}},{key:"getFirstTime",value:function getFirstTime(){}},{key:"getLastTime",value:function getLastTime(){}}]);return Cluster}();var BlockEntry=function BlockEntry(dataView){_classCallCheck(this,BlockEntry);this.dataView=dataView;this.offset;this.dataOffset;this.size;this.kind;this.cluster};var Frame=function(){function Frame(dataView){_classCallCheck(this,Frame);this.dataView=dataView;this.offset;this.dataOffset;this.size}_createClass(Frame,[{key:"read",value:function read(){}}]);return Frame}();var SimpleBlock=function(_BlockEntry){_inherits(SimpleBlock,_BlockEntry);function SimpleBlock(dataView){_classCallCheck(this,SimpleBlock);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(SimpleBlock).call(this,dataView));_this.offset;_this.dataOffset;_this.size;_this.block=new Block(dataView);return _this}_createClass(SimpleBlock,[{key:"parse",value:function parse(){this.block.dataOffset=this.dataOffset;this.block.size=this.size;this.block.parse()}}]);return SimpleBlock}(BlockEntry);var Block=function(){function Block(dataView){_classCallCheck(this,Block);this.dataView=dataView;this.offset;this.dataOffset;this.size;this.flags;this.track;this.timeCode=-1;this.frames=[];this.frameCount;this.discardPadding}_createClass(Block,[{key:"getTime",value:function getTime(){}},{key:"isKey",value:function isKey(){}},{key:"setKey",value:function setKey(){}},{key:"isInvisible",value:function isInvisible(){}},{key:"parse",value:function parse(){var offset=this.dataOffset;var end=offset+this.size;var elementId;var elementWidth;var elementOffset;var trackId=VINT.read(this.dataView,offset);this.track=trackId.data;offset+=trackId.width;this.timeCode=this.dataView.getInt16(offset);offset+=2;this.flags=this.dataView.getUint8(offset);this.lacing=(this.flags&6)>>1;offset++;if(this.lacing===0){this.frameCount=1;this.frames[0]=new Frame(this.dataView);this.frames[0].dataOffset=offset;this.frames[0].size=this.size}}}]);return Block}();var SeekHead=function(){function SeekHead(dataView){_classCallCheck(this,SeekHead);this.dataView=dataView;this.offset;this.dataOffset;this.size;this.entries=[];this.entryCount=0;this.voidElements=[];this.voidElementCount=0}_createClass(SeekHead,[{key:"parse",value:function parse(){console.log("parsing seek head");this.entryCount=0;this.voidElementCount=0;var offset=this.dataOffset;var end=this.dataOffset+this.size;var elementId;var elementWidth;var elementOffset;while(offset<end){elementOffset=offset;elementId=VINT.read(this.dataView,offset);offset+=elementId.width;elementWidth=VINT.read(this.dataView,offset);offset+=elementWidth.width;if(elementId.raw===Element.IdTable.Seek){var entry=new Entry(this.dataView);entry.dataOffset=offset;entry.offset=elementOffset;entry.size=elementWidth.data;entry.parse();this.entries.push(entry)}else if(elementId.raw===Element.IdTable.Void){}offset+=elementWidth.data}this.entryCount=this.entries.length;this.voidElementCount=this.voidElements.length}}]);return SeekHead}();var Entry=function(){function Entry(dataView){_classCallCheck(this,Entry);this.dataView=dataView;this.offset;this.dataOffset;this.size;this.id}_createClass(Entry,[{key:"parse",value:function parse(){this.voidElementCount=0;var offset=this.dataOffset;var end=this.dataOffset+this.size;var elementId;var elementWidth;var elementOffset;elementOffset=offset;elementId=VINT.read(this.dataView,offset);if(elementId.raw!=Element.IdTable.SeekID){console.warn("Seek ID not found")}offset+=elementId.width;elementWidth=VINT.read(this.dataView,offset);offset+=elementWidth.width;this.id=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);offset+=elementWidth.data;elementId=VINT.read(this.dataView,offset);if(elementId.raw!=Element.IdTable.SeekPosition){console.warn("Seek Position not found")}offset+=elementId.width;elementWidth=VINT.read(this.dataView,offset);offset+=elementWidth.width;this.seekPosition=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);offset+=elementWidth.data}}]);return Entry}();var VoidElement=function VoidElement(){_classCallCheck(this,VoidElement)};var Chapters=function(){function Chapters(dataView){_classCallCheck(this,Chapters);this.dataView=dataView;this.offset;this.dataOffset;this.size}_createClass(Chapters,[{key:"parse",value:function parse(){console.log("parsing chapters")}}]);return Chapters}();var Tags=function(){function Tags(dataView){_classCallCheck(this,Tags);this.dataView=dataView;this.offset;this.dataOffset;this.size}_createClass(Tags,[{key:"parse",value:function parse(){console.log("parsing tags")}}]);return Tags}();var Cues=function(){function Cues(dataView){_classCallCheck(this,Cues);this.dataView=dataView;this.offset;this.dataOffset;this.size;this.segment;this.cuePoints=[];this.count;this.preloadCount}_createClass(Cues,[{key:"getCount",value:function getCount(){return this.cuePoints.length}},{key:"init",value:function init(){}},{key:"preloadCuePoint",value:function preloadCuePoint(){}},{key:"find",value:function find(){}},{key:"getFirst",value:function getFirst(){}},{key:"getLast",value:function getLast(){}},{key:"getNext",value:function getNext(){}},{key:"getBlock",value:function getBlock(){}},{key:"findOrPreloadCluster",value:function findOrPreloadCluster(){}}]);return Cues}();var Tracks=function(){function Tracks(dataView){_classCallCheck(this,Tracks);this.dataView=dataView;this.segment;this.offset;this.dataOffset;this.size;this.trackEntries;this.trackEntriesEnd}_createClass(Tracks,[{key:"parse",value:function parse(){console.log("parsing tracks");this.trackEntries=null;this.trackEntriesEnd=null;var end=this.dataOffset+this.size;var offset=this.dataOffset;var count=0;var elementId;var elementWidth;var elementOffset;while(offset<end){elementId=VINT.read(this.dataView,offset);offset+=elementId.width;elementWidth=VINT.read(this.dataView,offset);offset+=elementWidth.width;if(elementId.raw===Element.IdTable.TrackEntry){count++}offset+=elementWidth.data;if(offset>end)console.warn("invalid track format")}if(count<0){return}this.trackEntries=[];offset=this.dataOffset;var payloadEnd;var elementTotalSize;while(offset<end){elementOffset=offset;elementId=VINT.read(this.dataView,offset);offset+=elementId.width;elementWidth=VINT.read(this.dataView,offset);offset+=elementWidth.width;payloadEnd=offset+elementWidth.data;elementTotalSize=payloadEnd-elementOffset;if(elementId.raw===Element.IdTable.TrackEntry){this.trackEntries.push(this.ParseTrackEntry(offset,elementWidth.data))}offset+=elementWidth.data}}},{key:"ParseTrackEntry",value:function ParseTrackEntry(dataOffset,size){var trackEntry;var trackInfo=new TrackInfo;var videoSettings=new TrackSettings;var audioSettings=new TrackSettings;var encodingSettings=new TrackSettings;var lacing=1;var end=dataOffset+size;var offset=dataOffset;var elementId;var elementWidth;var elementOffset;var lacing;while(offset<end){elementOffset=offset;elementId=VINT.read(this.dataView,offset);offset+=elementId.width;elementWidth=VINT.read(this.dataView,offset);offset+=elementWidth.width;switch(elementId.raw){case Element.IdTable.Video:videoSettings.offset=elementOffset;videoSettings.dataOffset=offset;videoSettings.size=elementWidth.data;break;case Element.IdTable.Audio:audioSettings.offset=elementOffset;audioSettings.dataOffset=offset;audioSettings.size=elementWidth.data;break;case Element.IdTable.ContentEncodings:encodingSettings.offset=elementOffset;encodingSettings.dataOffset=offset;encodingSettings.size=elementWidth.data;break;case Element.IdTable.TrackUID:break;case Element.IdTable.TrackNumber:trackInfo.number=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);break;case Element.IdTable.TrackType:trackInfo.type=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);break;case Element.IdTable.Name:trackInfo.name=Element.readString(this.dataView,offset,elementWidth.data);break;case Element.IdTable.Language:trackInfo.language=Element.readString(this.dataView,offset,elementWidth.data);break;case Element.IdTable.DefaultDuration:trackInfo.defaultDuration=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);break;case Element.IdTable.CodecID:trackInfo.codecID=Element.readString(this.dataView,offset,elementWidth.data);break;case Element.IdTable.FlagLacing:lacing=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);if(lacing<0||lacing>1)console.warn("invalid lacing");break;case Element.IdTable.CodecPrivate:break;case Element.IdTable.CodecName:trackInfo.codecName=Element.readString(this.dataView,offset,elementWidth.data);break;case Element.IdTable.CodecDelay:trackInfo.codecDelay=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);break;case Element.IdTable.SeekPreRoll:trackInfo.seekPreRoll=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);break;default:console.warn("track type not found");break}offset+=elementWidth.data}if(offset!=end)console.warn("invalid track");if(trackInfo.number<=0)console.warn("invalid track number");if(trackInfo.type<=0)console.warn("invalid track type");trackInfo.lacing=lacing>0?true:false;if(trackInfo.type===Track.Video){if(videoSettings.offset<0||audioSettings.offset>=0)console.warn("invalid video settings");trackInfo.settings=videoSettings;trackEntry=new VideoTrack(this.dataView,trackInfo);trackEntry.parse()}return trackEntry}}]);return Tracks}();var Track=function Track(dataView){_classCallCheck(this,Track);this.dataView=dataView;this.offset;this.dataOffset;this.size};Track.Video=1;Track.Audio=2;var VideoTrack=function(_Track){_inherits(VideoTrack,_Track);function VideoTrack(dataView,info){_classCallCheck(this,VideoTrack);var _this2=_possibleConstructorReturn(this,Object.getPrototypeOf(VideoTrack).call(this,dataView));_this2.width=0;_this2.height=0;_this2.displayWidth=0;_this2.displayHeight=0;_this2.displayUnit=0;_this2.stereoMode=0;_this2.rate=0;_this2.info=info;_this2.settings=info.settings;_this2.dataOffset=_this2.settings.dataOffset;_this2.offset=_this2.settings.offset;_this2.size=_this2.settings.size;_this2.color;return _this2}_createClass(VideoTrack,[{key:"parse",value:function parse(){var end=this.dataOffset+this.size;var offset=this.dataOffset;var elementId;var elementWidth;var elementOffset;while(offset<end){elementOffset=offset;elementId=VINT.read(this.dataView,offset);offset+=elementId.width;elementWidth=VINT.read(this.dataView,offset);offset+=elementWidth.width;switch(elementId.raw){case Element.IdTable.PixelWidth:this.width=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);break;case Element.IdTable.PixelHeight:this.height=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);break;case Element.IdTable.DisplayWidth:this.displayWidth=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);break;case Element.IdTable.DisplayHeight:this.displayHeight=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);break;case Element.IdTable.DisplayUnit:this.displayUnit=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);break;case Element.IdTable.StereoMode:this.stereoMode=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);break;case Element.IdTable.FrameRate:this.frameRate=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);break;case Element.IdTable.Colour:console.log("color");break;default:break}offset+=elementWidth.data}}}]);return VideoTrack}(Track);var TrackInfo=function TrackInfo(){_classCallCheck(this,TrackInfo);this.type=0;this.number=0;this.uid=0;this.defaultDuration=0;this.language;this.codecID;this.codecName};var TrackSettings=function TrackSettings(){_classCallCheck(this,TrackSettings);this.offset=-1;this.size=-1};var SegmentInfo=function(){function SegmentInfo(dataView){_classCallCheck(this,SegmentInfo);this.dataView=dataView;this.offset;this.size;this.dataOffset;this.muxingApp;this.writingApp;this.title;this.dataOffset;this.timecodeScale;this.duration}_createClass(SegmentInfo,[{key:"parse",value:function parse(){console.log("parsing segment info");var end=this.dataOffset+this.size;var offset=this.dataOffset;var elementId;var elementWidth;var elementOffset;this.timecodeScale=1e6;this.duration=-1;while(offset<end){elementOffset=offset;elementId=VINT.read(this.dataView,offset);offset+=elementId.width;elementWidth=VINT.read(this.dataView,offset);offset+=elementWidth.width;switch(elementId.raw){case Element.IdTable.TimecodeScale:this.timecodeScale=Element.readUnsignedInt(this.dataView,offset,elementWidth.data);if(this.timecodeScale<=0)console.warn("Invalid timecode scale");break;case Element.IdTable.Duration:this.duration=Element.readFloat(this.dataView,offset,elementWidth.data);if(this.duration<=0)console.warn("Invalid duration");break;case Element.IdTable.MuxingApp:this.muxingApp=Element.readString(this.dataView,offset,elementWidth.data);break;case Element.IdTable.WritingApp:this.writingApp=Element.readString(this.dataView,offset,elementWidth.data);break;case Element.IdTable.Title:this.title=Element.readString(this.dataView,offset,elementWidth.data);break;default:console.warn("segment info element not found");break}offset+=elementWidth.data}}}]);return SegmentInfo}();var EBMLHeader=function(){function EBMLHeader(dataView){_classCallCheck(this,EBMLHeader);this._dataView=dataView;this._totalSize=0;this.version;this.readVersion;this.maxIdLength;this.maxSizeLength;this.docTypeVersion;this.docTypeReadVersion}_createClass(EBMLHeader,[{key:"getTotalSize",value:function getTotalSize(){return this._totalSize}},{key:"parse",value:function parse(){var offset=0;var headerOffset=offset;var elementId=VINT.read(this._dataView,offset);if(elementId.raw!=Element.IdTable.EBML){console.warn("INVALID HEADER")}offset+=elementId.width;var elementSize=VINT.read(this._dataView,offset);this._totalSize=elementId.width+elementSize.width+elementSize.data;offset+=elementSize.width;var element;var end=headerOffset+elementId.width+elementSize.width+elementSize.data;while(offset<end){element=Element.getElement(this._dataView,offset,end);if(element){offset+=element.headerSize;switch(element.id){case Element.IdTable.EBMLVersion:this.version=Element.readUnsignedInt(this._dataView,offset,element.size);break;case Element.IdTable.EBMLReadVersion:this.readVersion=Element.readUnsignedInt(this._dataView,offset,element.size);break;case Element.IdTable.EBMLMaxIDLength:this.maxIdLength=Element.readUnsignedInt(this._dataView,offset,element.size);break;case Element.IdTable.EBMLMaxSizeLength:this.maxSizeLength=Element.readUnsignedInt(this._dataView,offset,element.size);break;case Element.IdTable.DocType:this.docType=Element.readString(this._dataView,offset,element.size);break;case Element.IdTable.DocTypeVersion:this.docTypeVersion=Element.readUnsignedInt(this._dataView,offset,element.size);break;case Element.IdTable.DocTypeReadVersion:this.docTypeReadVersion=Element.readUnsignedInt(this._dataView,offset,element.size);break;default:console.log("not found");break}}else{console.warn("File Reading error in header")}offset+=element.size}if(offset!=end){console.warn("invalid file format")}if(this.docType===null||this.docTypeReadVersion<=0||this.docTypeVersion<=0){console.warn("invalid file format")}if(this.maxIdLength<=0||this.maxIdLength>4||this.maxSizeLength<=0||this.maxSizeLength>8){console.warn("invalid file format")}}}]);return EBMLHeader}();var Webm=function(){function Webm(arrayBuffer){_classCallCheck(this,Webm);this.dataview=new DataView(arrayBuffer);this.header=new EBMLHeader(this.dataview);this.body=null}_createClass(Webm,[{key:"parse",value:function parse(){this.header.parse();var bodyOffset=this.header.getTotalSize();var offset=bodyOffset;this.body=MasterSegment.CreateInstance(this.dataview,offset);this.body.load();console.log(this)}},{key:"toJson",value:function toJson(){var webm={header:this.header,body:this.body};return JSON.stringify(webm,null,2)}},{key:"getFirstFrame",value:function getFirstFrame(){var frameData=this.body.cluster.entries[0].block.frames[0];var offset=frameData.dataOffset;var size=frameData.size;var frameBuffer=frameData.dataView.buffer.slice(offset,offset+size);return new DataView(frameBuffer)}}],[{key:"load",value:function load(arrayBuffer){var webm=new Webm(arrayBuffer);webm.parse();var firstFrame=webm.getFirstFrame();var vp9=new VP9;vp9.decode(firstFrame);return webm}},{key:"getVersion",value:function getVersion(){return{major:1,minor:0,build:0,revision:30}}}]);return Webm}();var Element=function(){_createClass(Element,null,[{key:"readUnsignedInt",value:function readUnsignedInt(dataView,offset,size){if(offset<0||size<=0||size>8){console.warn("invalid file size")}var result=0;var b;for(var i=0;i<size;i++){b=dataView.getUint8(offset);if(i===0&&b<0){console.warn("invalid integer value")}result<<=8;result|=b;offset++}return result}},{key:"readFloat",value:function readFloat(dataView,offset,size){if(offset<0&&(size===4||size===8)){console.warn("invalid float size")}if(size===4){return dataView.getFloat32(offset)}else{return dataView.getFloat64(offset)}}},{key:"readUT8F",value:function readUT8F(dataView,offset,size){var tempString="";for(var i=0;i<size;i++){tempString+=String.fromCharCode(dataView.getUint8(offset+i))}return btoa(tempString)}},{key:"readString",value:function readString(dataView,offset,size){var tempString="";for(var i=0;i<size;i++){tempString+=String.fromCharCode(dataView.getUint8(offset+i))}return tempString}},{key:"getElement",value:function getElement(dataView,offset,end){var elementOffset=offset;if(offset>=end){console.warn("read error");return false}var elementIdVint=VINT.read(dataView,offset);var elementId=elementIdVint.raw;if(elementId<0){console.warn("id read error");return false}else if(elementId===0){console.warn("invalid file format");return false}offset+=elementIdVint.width;if(offset>=end){console.warn("read error");return false}var elementSize=VINT.read(dataView,offset);if(elementSize.data<0||elementSize.width<1||elementSize.width>8){console.warn("Invalid File Format");return false}offset+=elementSize.width;if(offset>=end){console.warn("read error");return false}var element=new Element(elementIdVint.raw,dataView);element.size=elementSize.data;element.dataOffset=offset;element.headerSize=elementSize.width+elementIdVint.width;return element}}]);function Element(id,dataView){_classCallCheck(this,Element);this._dataView=dataView;this._id=id;this.id=id;this._offset;this._size;this._totalSize;this.dataOffset;this.status;this.headerSize;this.size}_createClass(Element,[{key:"setSize",value:function setSize(size){this._size=size}},{key:"getTotalSize",value:function getTotalSize(){return this._size.data+this.getIdLength()+this._size.width}},{key:"setOffset",value:function setOffset(offset){this._offset=offset}},{key:"parse",value:function parse(){console.log("Needs to be implemented")}},{key:"getIdLength",value:function getIdLength(){var length;switch(this.EBMLClass){case"A":length=1;break;case"B":length=2;break;case"C":length=3;break;case"D":length=4;break}return length}}]);return Element}();var EBMLSignedInteger=function(_Element){_inherits(EBMLSignedInteger,_Element);function EBMLSignedInteger(id,dataView){_classCallCheck(this,EBMLSignedInteger);var _this3=_possibleConstructorReturn(this,Object.getPrototypeOf(EBMLSignedInteger).call(this,id,dataView));_this3.length;_this3.value;return _this3}_createClass(EBMLSignedInteger,[{key:"parse",value:function parse(){if(this._size.data===0){this.value=0}else{var tempOffset=this._offset+this.getIdLength()+this._size.width;this.value=VINT.read(this._dataView,tempOffset).data}}}]);return EBMLSignedInteger}(Element);var EBMLUnsignedInteger=function(_Element2){_inherits(EBMLUnsignedInteger,_Element2);function EBMLUnsignedInteger(id,dataView){_classCallCheck(this,EBMLUnsignedInteger);var _this4=_possibleConstructorReturn(this,Object.getPrototypeOf(EBMLUnsignedInteger).call(this,id,dataView));_this4.value;return _this4}_createClass(EBMLUnsignedInteger,[{key:"parse",value:function parse(){var tempOctet=0;var readOctet;var tempOffset=this._offset+this.getIdLength()+this._size.width;for(var i=0;i<this._size.data;i++){readOctet=this._dataView.getUint8(tempOffset+i);tempOctet=tempOctet<<8*i|readOctet}this.value=tempOctet}}]);return EBMLUnsignedInteger}(Element);var EBMLString=function(_Element3){_inherits(EBMLString,_Element3);function EBMLString(id,dataView){_classCallCheck(this,EBMLString);var _this5=_possibleConstructorReturn(this,Object.getPrototypeOf(EBMLString).call(this,id,dataView));_this5.length;_this5.value;return _this5}_createClass(EBMLString,[{key:"parse",value:function parse(){var tempOffset=this._offset+this.getIdLength()+this._size.width;var charCount=this._size.data;var tempString="";for(var i=0;i<charCount;i++){tempString+=String.fromCharCode(this._dataView.getUint8(tempOffset+i))}this.value=tempString}}]);return EBMLString}(Element);var EBMLUTF8=function(_Element4){_inherits(EBMLUTF8,_Element4);function EBMLUTF8(id,dataView){_classCallCheck(this,EBMLUTF8);var _this6=_possibleConstructorReturn(this,Object.getPrototypeOf(EBMLUTF8).call(this,id,dataView));_this6.length;_this6.value;return _this6}_createClass(EBMLUTF8,[{key:"parse",value:function parse(){var tempOffset=this._offset+this.getIdLength()+this._size.width;var charCount=this._size.data;var tempString="";for(var i=0;i<charCount;i++){tempString+=String.fromCharCode(this._dataView.getUint8(tempOffset+i))}this.value=btoa(tempString)}}]);return EBMLUTF8}(Element);var EBMLDate=function(_Element5){_inherits(EBMLDate,_Element5);function EBMLDate(id,dataView){_classCallCheck(this,EBMLDate);var _this7=_possibleConstructorReturn(this,Object.getPrototypeOf(EBMLDate).call(this,id,dataView));
_this7.length;_this7.value;return _this7}return EBMLDate}(Element);var EBMLFloat=function(_Element6){_inherits(EBMLFloat,_Element6);function EBMLFloat(id,dataView){_classCallCheck(this,EBMLFloat);var _this8=_possibleConstructorReturn(this,Object.getPrototypeOf(EBMLFloat).call(this,id,dataView));_this8.length;_this8.value;return _this8}return EBMLFloat}(Element);var EBMLMasterElement=function(_Element7){_inherits(EBMLMasterElement,_Element7);function EBMLMasterElement(id,dataView){_classCallCheck(this,EBMLMasterElement);var _this9=_possibleConstructorReturn(this,Object.getPrototypeOf(EBMLMasterElement).call(this,id,dataView));_this9.length;_this9.elements=[];return _this9}_createClass(EBMLMasterElement,[{key:"getNextElement",value:function getNextElement(internalOffset){var tempOffset=internalOffset;var elementOffset=internalOffset;var elementId=VINT.read(this._dataView,internalOffset);tempOffset+=elementId.width;var elementSize=VINT.read(this._dataView,tempOffset);var elementClass=Element.ClassTable[elementId.raw];var element;if(elementClass){element=new elementClass(this._dataView);element.setOffset(elementOffset);element.setSize(elementSize)}else{console.log("Element Not Found"+elementId.raw);return false}return element}},{key:"parse",value:function parse(){var tempOffset=this._offset+this.getIdLength()+this._size.width;var nextElement;if(this._id===Element.IdTable.Info){}while(tempOffset<this._offset+this.getTotalSize()){nextElement=this.getNextElement(tempOffset);if(nextElement){this.elements.push(nextElement);nextElement.parse();tempOffset+=nextElement.getTotalSize()}else{console.log("Element Not Found"+this);break}}}}]);return EBMLMasterElement}(Element);var EBMLBinary=function(_Element8){_inherits(EBMLBinary,_Element8);function EBMLBinary(id,dataView){_classCallCheck(this,EBMLBinary);var _this10=_possibleConstructorReturn(this,Object.getPrototypeOf(EBMLBinary).call(this,id,dataView));_this10.data;_this10._dataOffset;return _this10}_createClass(EBMLBinary,[{key:"parse",value:function parse(){this._dataOffset=this._offset+this.getIdLength()+this._size.width}}]);return EBMLBinary}(Element);Element.IdTable={EBML:440786851,EBMLVersion:17030,EBMLReadVersion:17143,EBMLMaxIDLength:17138,EBMLMaxSizeLength:17139,DocType:17026,DocTypeVersion:17031,DocTypeReadVersion:17029,Void:236,Segment:408125543,SeekHead:290298740,Seek:19899,SeekID:21419,SeekPosition:21420,Info:357149030,TimecodeScale:2807729,Duration:17545,DateUTC:4461,Title:31657,MuxingApp:19840,WritingApp:22337,Cluster:524531317,Timecode:231,PrevSize:171,SimpleBlock:163,BlockGroup:160,Block:161,BlockAdditions:30113,BlockMore:166,BlockAddID:238,BlockAdditional:165,BlockDuration:155,ReferenceBlock:251,DiscardPadding:30114,Tracks:374648427,TrackEntry:174,TrackNumber:215,TrackUID:29637,TrackType:131,FlagEnabled:185,FlagDefault:136,FlagForced:21930,FlagLacing:156,DefaultDuration:2352003,Name:21358,Language:2274716,CodecID:134,CodecPrivate:25506,CodecName:2459272,CodecDelay:22186,SeekPreRoll:22203,Video:224,FlagInterlaced:154,StereoMode:21432,AlphaMode:21440,PixelWidth:176,PixelHeight:186,PixelCropBottom:21674,PixelCropTop:21691,PixelCropLeft:21708,PixelCropRight:21725,DisplayWidth:21680,DisplayHeight:21690,DisplayUnit:21682,AspectRatioType:21683,Audio:225,SamplingFrequency:181,OutputSamplingFrequency:30901,Channels:159,BitDepth:25188,ContentEncodings:28032,ContentEncoding:25152,ContentEncodingOrder:20529,ContentEncodingScope:20530,ContentEncodingType:20531,ContentEncryption:20533,ContentEncAlgo:18401,ContentEncKeyID:18402,FrameRate:2327523,Colour:21936,MatrixCoefficients:21937,BitsPerChannel:21938,ChromaSubsamplingHorz:21939,ChromaSubsamplingVert:21940,CbSubsamplingHorz:21941,CbSubsamplingVert:21942,ChromaSitingHorz:21943,ChromaSitingVert:21944,Range:21945,TransferCharacteristics:21946,Primaries:21947,MaxCLL:21948,MaxFALL:21949,MasteringMetadata:21968,PrimaryRChromaticityX:21969,PrimaryRChromaticityY:21970,PrimaryGChromaticityX:21971,PrimaryGChromaticityY:21972,PrimaryBChromaticityX:21973,PrimaryBChromaticityY:21974,WhitePointChromaticityX:21975,WhitePointChromaticityY:21976,LuminanceMax:21977,LuminanceMin:21978,Cues:475249515,CuePoint:187,CueTime:179,CueTrackPositions:183,CueTrack:247,CueClusterPosition:241,CueRelativePosition:240,CueDuration:178,CueBlockNumber:21368,Chapters:272869232,EditionEntry:17849,ChapterAtom:182,ChapterUID:29636,ChapterStringUID:22100,ChapterTimeStart:145,ChapterTimeEnd:146,ChapterDisplay:128,ChapString:133,ChapLanguage:17278,ChapCountry:17278,Tags:307544935,Tag:29555,Targets:25536,TargetTypeValue:26826,TargetType:25546,TagTrackUID:25541,SimpleTag:26568,TagName:17827,TagLanguage:17530,TagDefault:17543,TagString:17543,TagBinary:17541};console.log(Element.IdTable);if("global"==="global"){window.Flare=window.Flare||{};Flare.Codec=Flare.Codec||{};window.Flare.Codec.Webm=Webm}else{module.exports.Webm=Webm}},{"./VINT.js":1,"./codecs/VP9/VP9.js":2}]},{},[4]);